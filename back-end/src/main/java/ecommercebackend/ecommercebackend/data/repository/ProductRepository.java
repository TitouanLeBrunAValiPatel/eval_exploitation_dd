package ecommercebackend.ecommercebackend.data.repository;

import ecommercebackend.ecommercebackend.data.entity.database.Product;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;

import java.util.List;

public interface ProductRepository extends JpaRepository<Product, Integer> {
    List<Product> findAllByCategoryId(int categoryId);

    //    @Query("""
//            SELECT p.*, COUNT(*) as number_order FROM products p INNER JOIN order_products o ON p.id = o.product_id
//            GROUP BY (o.product_id)
//            ORDER BY number_order DESC""")
    @Query("SELECT p, COUNT(*) as number_order FROM Product p " +
            "INNER JOIN OrderProduct o ON p.id = o.product.id " +
            "GROUP BY o.product.id " +
            "ORDER BY number_order DESC")
    List<Product> findAllBestSellers();
}
