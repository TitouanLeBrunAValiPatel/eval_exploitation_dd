import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
import HomePage from './components/Home/HomePage';
import CategoryPage from './components/Category/CategoryPage';
import LoginPage from './components/LoginPage/LoginPage';
import ProfilPage from './components/ProfilPage/ProfilPage';
import SearchBar from './components/Searchbar/SearchBar'
import { useLocation } from 'react-router-dom';
import { useEffect } from 'react';
import { AuthState, useAuth } from './hook/useAuth';
import ItemSolo from './components/Category/ItemSolo';

function Main() {
  const location = useLocation();

  return (
    <>
      {location.pathname !== '/login' && <SearchBar />}
      <Routes>

        <Route path="/*" element={<HomePage />} />
        <Route path="/category/:categoryName/" element={<CategoryPage />} />
        <Route path="/category/:categoryName/:NameOfTheItem/:id" element={<ItemSolo />} />
        <Route path="/login" element={<LoginPage />} />
        <Route path="/profil" element={<ProfilPage />} />
      </Routes>

    </>
  );
}

function App() {
  const { status, authenticate } = useAuth();
  useEffect(() => {
    authenticate();
  }
    , []);

  return (
    <Router>
      {status === AuthState.unknown && <div>loading...</div>}
      {status === AuthState.unauthenticated && <LoginPage />}
      {status === AuthState.authenticated && <Main />}
    </Router>
  );
}


export default App;
